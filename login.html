<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Iniciar Sesión - ServeSalud</title>
  <link rel="stylesheet" href="css/styles.css" />
  <style>
    .ss-alert-inline { position: fixed; right: 20px; bottom: 20px; padding: 12px 16px; border-radius: 10px; box-shadow:0 6px 18px rgba(0,0,0,0.12); z-index:9999; opacity:0; transform:translateY(10px); transition:all .25s; }
    .ss-alert-inline.show{opacity:1;transform:translateY(0);}
    .ss-alert-inline.success{background:#e6ffef;color:#064e3b;}
    .ss-alert-inline.error{background:#ffebeb;color:#6b1b1b;}
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <div class="logo"><a href="index.html"><img src="img/Logo ServeSalud.png" alt="ServeSalud" class="logo-img"></a></div>
    </div>
  </header>

  <main class="section">
    <div class="container container-form" style="max-width:520px">
      <h2>Iniciar Sesión</h2>
      <p class="muted">Usa una cuenta registrada.</p>

      <form id="login-form" novalidate>
        <label for="email">Correo electrónico</label>
        <input type="email" id="email" required>
        <label for="password">Contraseña</label>
        <input type="password" id="password" required>
        <button type="submit" class="btn-primary" style="width:100%;margin-top:10px">Iniciar sesión</button>
      </form>

      <p style="margin-top:12px"><a href="register.html">Crear cuenta</a> · <a href="recover.html">Recuperar contraseña</a></p>
    </div>
  </main>

  <div id="ss-alert-root"></div>

  <script>
    (function(){
      'use strict';
      function lsGet(key){ try{ const r = localStorage.getItem(key); return r ? JSON.parse(r) : null }catch(e){console.error(e); return null} }
      function sessionSet(key,val){ try{ sessionStorage.setItem(key, JSON.stringify(val)); }catch(e){console.error(e)} }
      function showAlert(msg,type='success'){ const root = document.getElementById('ss-alert-root'); if(!root) return; const el = document.createElement('div'); el.className = 'ss-alert-inline ' + (type==='error'?'error':'success'); el.textContent = msg; root.appendChild(el); requestAnimationFrame(()=> el.classList.add('show')); setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=> el.remove(),300) },2400); }

      // seed if missing
      if(!lsGet('ss_users')){
        localStorage.setItem('ss_users', JSON.stringify([
          { id: 'u_admin', name: 'Admin Serve', email: 'admin@servesalud.org', role: 'admin', password: 'admin123' },
          { id: 'u_coord', name: 'Coordinador', email: 'coord@servesalud.org', role: 'coordinador', password: 'coord123' },
          { id: 'u_demo', name: 'Usuario Demo', email: 'demo@servesalud.org', role: 'voluntario', password: 'demo123', hours: 32 }
        ]));
      }

      const form = document.getElementById('login-form');
      if(!form) return;
      form.addEventListener('submit', function(e){
        e.preventDefault();
        const email = (document.getElementById('email')||{}).value.trim().toLowerCase();
        const pwd = (document.getElementById('password')||{}).value;
        if(!email || !pwd){ showAlert('Ingresa correo y contraseña', 'error'); return; }

        const users = lsGet('ss_users') || [];
        const user = users.find(u => u.email === email && u.password === pwd);
        if(!user){ showAlert('Credenciales incorrectas', 'error'); return; }

        sessionSet('ss_current_user', user);
        showAlert('Bienvenido ' + user.name + '. Redirigiendo...', 'success');
        setTimeout(()=> {
          // redirige según rol si deseas; por ahora a perfil
          window.location.href = (user.role === 'coordinador') ? 'coordinador-dashboard.html' : 'perfil.html';
        }, 800);
      });
    })();
  </script>
</body>
</html>